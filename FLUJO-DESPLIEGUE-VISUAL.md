# Flujo Visual de Despliegue - Sistema SAD en cPanel

## ๐ Arquitectura del Sistema en Producciรณn

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    USUARIO FINAL (Navegador)                     โ
โ           http://archivos.risvirgendecocharcas.gob.pe           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                             โ
                             โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                     CPANEL / APACHE SERVER                       โ
โ                        (.htaccess rules)                         โ
โโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโ
               โ                                  โ
       โโโโโโโโโผโโโโโโโโโ              โโโโโโโโโโโผโโโโโโโโโโโ
       โ  /api/* โ      โ              โ  /* โ              โ
       โ  Backend       โ              โ  Frontend          โ
       โ  (Port 5001)   โ              โ  (Port 3000)       โ
       โโโโโโโโโฌโโโโโโโโโ              โโโโโโโโโโโฌโโโโโโโโโโโ
               โ                                  โ
               โ                                  โ
       โโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
       โ          Node.js Runtime (cPanel)                 โ
       โ                                                    โ
       โ  โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ   โ
       โ  โ  Backend App     โ    โ  Frontend App    โ   โ
       โ  โ  Express.js      โ    โ  Next.js 15      โ   โ
       โ  โ  + Prisma ORM    โ    โ  Standalone      โ   โ
       โ  โโโโโโโโโโฌโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ   โ
       โโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                   โ
                   โผ
       โโโโโโโโโโโโโโโโโโโโโโโโโโโ
       โ   MySQL Database        โ
       โ   (cPanel MySQL)        โ
       โ                         โ
       โ   dchincheros_          โ
       โ   archivo_digital_disa  โ
       โโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Flujo de Despliegue Paso a Paso

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    PASO 1: TU COMPUTADORA                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                             โ
                             โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  1.1 Build Backend                   โ
        โ  npm run build โ dist/               โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  1.2 Build Frontend                  โ
        โ  npm run build โ .next/standalone/   โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  1.3 Preparar Base de Datos          โ
        โ  โข Crear BD temporal local           โ
        โ  โข Ejecutar migraciones              โ
        โ  โข Crear usuario admin               โ
        โ  โข Exportar SQL                      โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  1.4 Comprimir node_modules          โ
        โ  โข backend/node_modules.zip          โ
        โ  โข frontend/node_modules.zip         โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ             PASO 2: CONFIGURACIรN EN CPANEL                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  2.1 Crear Base de Datos MySQL       โ
        โ  โข Base de datos                     โ
        โ  โข Usuario                           โ
        โ  โข Asignar privilegios               โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  2.2 Importar Estructura SQL         โ
        โ  phpMyAdmin โ Importar               โ
        โ  โข schema-produccion.sql             โ
        โ  โข admin-data.sql                    โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  2.3 Crear Directorios               โ
        โ  /archivos/backend/                  โ
        โ  /archivos/frontend/                 โ
        โ  /archivos/backend/uploads/          โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  PASO 3: SUBIR ARCHIVOS (FTP)                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
        โโโโโโโโโโโโโโดโโโโโโโโโโโโโ
        โ                         โ
        โผ                         โผ
โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ
โ  Backend Files   โ    โ  Frontend Files  โ
โโโโโโโโโโโโโโโโโโโโค    โโโโโโโโโโโโโโโโโโโโค
โ โข dist/          โ    โ โข .next/         โ
โ โข prisma/        โ    โ โข public/        โ
โ โข package.json   โ    โ โข package.json   โ
โ โข .env           โ    โ โข .env           โ
โ โข node_modules/  โ    โ โข node_modules/  โ
โ โข *.traineddata  โ    โ                  โ
โโโโโโโโโโฌโโโโโโโโโโ    โโโโโโโโโโฌโโโโโโโโโโ
         โ                       โ
         โโโโโโโโโโโโโฌโโโโโโโโโโโโ
                     โ
                     โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ            PASO 4: CONFIGURAR NODE.JS APPS                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
        โโโโโโโโโโโโโโดโโโโโโโโโโโโโ
        โ                         โ
        โผ                         โผ
โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ
โ  Backend App     โ    โ  Frontend App    โ
โโโโโโโโโโโโโโโโโโโโค    โโโโโโโโโโโโโโโโโโโโค
โ Node.js 18.x     โ    โ Node.js 18.x     โ
โ Production       โ    โ Production       โ
โ dist/server.js   โ    โ .next/standalone โ
โ                  โ    โ /server.js       โ
โ Variables env:   โ    โ                  โ
โ โข DATABASE_URL   โ    โ Variables env:   โ
โ โข JWT_SECRET     โ    โ โข NEXT_PUBLIC_   โ
โ โข FIRMA_PERU_*   โ    โ   API_URL        โ
โโโโโโโโโโฌโโโโโโโโโโ    โโโโโโโโโโฌโโโโโโโโโโ
         โ                       โ
         โโโโโโโโโโโโโฌโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  Restart Apps                        โ
        โ  โ Backend: Running                  โ
        โ  โ Frontend: Running                 โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    PASO 5: VERIFICACIรN                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
        โโโโโโโโโโโโโโดโโโโโโโโโโโโโ
        โ                         โ
        โผ                         โผ
โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ
โ  Health Check    โ    โ  Login Test      โ
โโโโโโโโโโโโโโโโโโโโค    โโโโโโโโโโโโโโโโโโโโค
โ /api/health      โ    โ Username: admin  โ
โ Status: OK โ     โ    โ Password: ***    โ
โ DB: Connected โ  โ    โ Login: OK โ      โ
โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ
         โ                       โ
         โโโโโโโโโโโโโฌโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  โ SISTEMA DESPLEGADO EXITOSAMENTE   โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Flujo de Actualizaciรณn

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ               ACTUALIZACIรN DE CรDIGO (Solo cรณdigo)              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                             โ
                             โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  LOCAL: Hacer cambios en cรณdigo      โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  LOCAL: npm run build (ambos)        โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  FTP: Reemplazar dist/ y .next/      โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  cPanel: Restart Apps                โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  โ Actualizaciรณn Completada          โ
        โ  Tiempo: ~10 minutos                 โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         ACTUALIZACIรN DE BASE DE DATOS (Cambios schema)          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                             โ
                             โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  LOCAL: Modificar schema.prisma      โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  LOCAL: prisma migrate dev           โ
        โ  Genera: migration.sql               โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  โ๏ธ BACKUP: Exportar BD producciรณn   โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  phpMyAdmin: Ejecutar migration.sql  โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  FTP: Subir schema.prisma            โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  LOCAL: npm run build                โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  FTP: Reemplazar dist/               โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  cPanel: Restart Backend App         โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  โ Actualizaciรณn BD Completada       โ
        โ  Tiempo: ~20-30 minutos              โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Estructura de Directorios en Producciรณn

```
/home/dchincheros/archivos/
โ
โโโ .htaccess                          # Configuraciรณn Apache (rewrite rules)
โ
โโโ backend/                           # APLICACIรN BACKEND
โ   โโโ dist/                         # โ Cรณdigo compilado (subir siempre)
โ   โ   โโโ server.js                # โ Entry point
โ   โ   โโโ app.js
โ   โ   โโโ config/
โ   โ   โโโ controllers/
โ   โ   โโโ middlewares/
โ   โ   โโโ routes/
โ   โ   โโโ services/
โ   โ   โโโ utils/
โ   โ
โ   โโโ node_modules/                 # โ Dependencias (subir al inicio o si cambian)
โ   โ   โโโ .prisma/                 # โ๏ธ Importante: Cliente Prisma generado
โ   โ   โโโ @prisma/client/          # โ๏ธ Importante: Cliente Prisma
โ   โ
โ   โโโ prisma/                       # โ Configuraciรณn de Prisma
โ   โ   โโโ schema.prisma            # โ Esquema de BD
โ   โ
โ   โโโ uploads/                      # โ๏ธ PERMISOS: 755
โ   โ   โโโ documents/               # โ๏ธ PERMISOS: 755 (PDFs de usuarios)
โ   โ   โ   โโโ [archivos dinรกmicos]
โ   โ   โโโ system/                  # โ๏ธ PERMISOS: 755 (logos, favicon)
โ   โ       โโโ [archivos de config]
โ   โ
โ   โโโ spa.traineddata              # โ OCR Espaรฑol
โ   โโโ eng.traineddata              # โ OCR Inglรฉs
โ   โโโ package.json                 # โ Dependencias
โ   โโโ package-lock.json            # โ Lock file
โ   โโโ .env.production              # โ Variables de entorno
โ
โโโ frontend/                          # APLICACIรN FRONTEND
โ   โโโ .next/                        # โ Build de Next.js (subir siempre)
โ   โ   โโโ standalone/              # โ Servidor standalone
โ   โ   โ   โโโ server.js           # โ Entry point
โ   โ   โ   โโโ .next/
โ   โ   โ   โ   โโโ static/         # โ๏ธ IMPORTANTE: Copiar desde /.next/static
โ   โ   โ   โโโ public/             # โ๏ธ IMPORTANTE: Copiar desde /public
โ   โ   โ
โ   โ   โโโ static/                  # โ Assets estรกticos (JS, CSS, imรกgenes)
โ   โ       โโโ chunks/
โ   โ
โ   โโโ node_modules/                 # โ Dependencias
โ   โ
โ   โโโ public/                       # โ Archivos pรบblicos
โ   โ
โ   โโโ package.json                 # โ Dependencias
โ   โโโ package-lock.json            # โ Lock file
โ   โโโ .env.production              # โ Variables de entorno
โ
โโโ tmp/                              # Temporal (Node.js)
```

**Leyenda**:
- `โ` = Archivo/carpeta que debes subir
- `โ๏ธ` = Requiere atenciรณn especial (permisos, configuraciรณn)
- `[...]` = Contenido dinรกmico generado por el sistema

---

## ๐ Flujo de Seguridad

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         USUARIO                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                             โ
                             โผ
                    โโโโโโโโโโโโโโโโโโ
                    โ   1. Login     โ
                    โ   (Frontend)   โ
                    โโโโโโโโโโฌโโโโโโโโ
                             โ
                             โผ
                    โโโโโโโโโโโโโโโโโโ
                    โ   POST /api/   โ
                    โ   auth/login   โ
                    โโโโโโโโโโฌโโโโโโโโ
                             โ
                             โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  2. Backend Valida Credenciales        โ
        โ  โข Busca usuario en BD                 โ
        โ  โข Compara password (bcrypt)           โ
        โ  โข Verifica que estรฉ activo            โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
            โโโโโโโโโโดโโโโโโโโโ
            โ                 โ
       โ FALLA            โ รXITO
            โ                 โ
            โผ                 โผ
    โโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโ
    โ  Error 401   โ   โ  3. Genera JWT   โ
    โ  Unauthorizedโ   โ  โข Access Token  โ
    โโโโโโโโโโโโโโโโ   โ  โข Refresh Token โ
                       โโโโโโโโโโฌโโโโโโโโโโ
                                โ
                                โผ
                       โโโโโโโโโโโโโโโโโโโโ
                       โ  4. Frontend     โ
                       โ  Guarda Token    โ
                       โ  (localStorage)  โ
                       โโโโโโโโโโฌโโโโโโโโโโ
                                โ
                                โผ
                       โโโโโโโโโโโโโโโโโโโโ
                       โ  5. Todas las    โ
                       โ  peticiones      โ
                       โ  incluyen:       โ
                       โ  Authorization:  โ
                       โ  Bearer <token>  โ
                       โโโโโโโโโโฌโโโโโโโโโโ
                                โ
                                โผ
                       โโโโโโโโโโโโโโโโโโโโ
                       โ  6. Middleware   โ
                       โ  Verifica Token  โ
                       โ  โข JWT vรกlido?   โ
                       โ  โข Expirรณ?       โ
                       โ  โข Usuario activoโ
                       โโโโโโโโโโฌโโโโโโโโโโ
                                โ
                       โโโโโโโโโโดโโโโโโโโโ
                       โ                 โ
                  โ INVรLIDO       โ VรLIDO
                       โ                 โ
                       โผ                 โผ
               โโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโ
               โ  Error 401   โ   โ  7. Ejecuta  โ
               โ  Redirige a  โ   โ  Operaciรณn   โ
               โ  Login       โ   โ  Solicitada  โ
               โโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโ
```

---

## ๐ Flujo de Subida de Documentos

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    USUARIO SUBE DOCUMENTO                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                             โ
                             โผ
                    โโโโโโโโโโโโโโโโโโ
                    โ  1. Frontend   โ
                    โ  Formulario    โ
                    โ  + File Upload โ
                    โโโโโโโโโโฌโโโโโโโโ
                             โ
                             โผ
                    โโโโโโโโโโโโโโโโโโโโโโ
                    โ  2. POST /api/     โ
                    โ  documents         โ
                    โ  (multipart/form)  โ
                    โโโโโโโโโโฌโโโโโโโโโโโโ
                             โ
                             โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  3. Backend Middleware                 โ
        โ  โข Multer procesa archivo              โ
        โ  โข Valida tipo (PDF)                   โ
        โ  โข Valida tamaรฑo (< 10MB)              โ
        โ  โข Genera nombre รบnico (UUID)          โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
            โโโโโโโโโโดโโโโโโโโโ
            โ                 โ
       โ FALLA            โ VรLIDO
            โ                 โ
            โผ                 โผ
    โโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโ
    โ  Error 400   โ   โ  4. Guarda en    โ
    โ  Bad Request โ   โ  /uploads/       โ
    โโโโโโโโโโโโโโโโ   โ  documents/      โ
                       โโโโโโโโโโฌโโโโโโโโโโ
                                โ
                                โผ
                       โโโโโโโโโโโโโโโโโโโโ
                       โ  5. Procesa OCR  โ
                       โ  (Tesseract.js)  โ
                       โ  โข Extrae texto  โ
                       โ  โข Guarda en BD  โ
                       โโโโโโโโโโฌโโโโโโโโโโ
                                โ
                                โผ
                       โโโโโโโโโโโโโโโโโโโโ
                       โ  6. Crea         โ
                       โ  registro en BD  โ
                       โ  (tabla:         โ
                       โ  documents)      โ
                       โโโโโโโโโโฌโโโโโโโโโโ
                                โ
                                โผ
                       โโโโโโโโโโโโโโโโโโโโ
                       โ  7. Audit Log    โ
                       โ  Registra acciรณn โ
                       โโโโโโโโโโฌโโโโโโโโโโ
                                โ
                                โผ
                       โโโโโโโโโโโโโโโโโโโโ
                       โ  8. Response     โ
                       โ  200 OK          โ
                       โ  + Document ID   โ
                       โโโโโโโโโโฌโโโโโโโโโโ
                                โ
                                โผ
                       โโโโโโโโโโโโโโโโโโโโ
                       โ  9. Frontend     โ
                       โ  Muestra รฉxito   โ
                       โ  + Redirecciona  โ
                       โโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Proceso de Firma Digital

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                   USUARIO INICIA FIRMA                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                             โ
                             โผ
                    โโโโโโโโโโโโโโโโโโ
                    โ  1. Frontend   โ
                    โ  Click en      โ
                    โ  "Firmar"      โ
                    โโโโโโโโโโฌโโโโโโโโ
                             โ
                             โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  2. Solicita OTT (One-Time Token)      โ
        โ  GET /api/firma/ott                    โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  3. Backend Genera OTT                 โ
        โ  โข Token รบnico temporal                โ
        โ  โข Vรกlido por 5 minutos                โ
        โ  โข Asociado al documento               โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  4. Frontend Carga FirmaPeru.js        โ
        โ  โข Script externo (apps.firmaperu...)  โ
        โ  โข Inicia cliente de firma             โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  5. Cliente Local FirmaPeru            โ
        โ  โข Se conecta a puerto 48596           โ
        โ  โข Detecta certificado digital         โ
        โ  โข Usuario ingresa PIN                 โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  6. Backend Procesa Firma              โ
        โ  POST /api/firma/process               โ
        โ  โข Valida OTT                          โ
        โ  โข Descarga PDF del documento          โ
        โ  โข Aplica firma al PDF                 โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  7. Crea Nueva Versiรณn                 โ
        โ  โข Guarda PDF firmado                  โ
        โ  โข Incrementa version_number           โ
        โ  โข Registra en tabla signatures        โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  8. Actualiza Estado del Documento     โ
        โ  โข signatureStatus = "SIGNED"          โ
        โ  โข lastSignedAt = now()                โ
        โ  โข currentVersion++                    โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  9. Response + Notification            โ
        โ  โข Frontend muestra รฉxito              โ
        โ  โข Crea notificaciรณn en sistema        โ
        โ  โข Audit log de la firma               โ
        โโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                     โ
                     โผ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
        โ  โ DOCUMENTO FIRMADO                   โ
        โ  โข Disponible para descarga            โ
        โ  โข Visible en historial                โ
        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Tiempos Estimados por Operaciรณn

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      DESPLIEGUE INICIAL                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Preparaciรณn Local........................... 30-45 min
Configuraciรณn cPanel BD..................... 10-15 min
Subida de Archivos (FTP).................... 45-90 min
Configuraciรณn Node.js Apps.................. 20-30 min
Verificaciรณn y Pruebas...................... 15-20 min
                                          โโโโโโโโโโโโโ
TOTAL ESTIMADO.............................. 2-4 horas


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  ACTUALIZACIรN (Solo Cรณdigo)                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Build Local................................. 3-5 min
Subida de dist/ y .next/.................... 10-15 min
Restart Apps................................ 1-2 min
                                          โโโโโโโโโโโโโ
TOTAL ESTIMADO.............................. 15-20 min


โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              ACTUALIZACIรN (Con Cambios en BD)                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

Backup BD................................... 2-3 min
Crear Migraciรณn............................. 2-3 min
Ejecutar SQL en phpMyAdmin.................. 3-5 min
Build y Subida.............................. 15-20 min
Restart y Verificaciรณn...................... 3-5 min
                                          โโโโโโโโโโโโโ
TOTAL ESTIMADO.............................. 25-35 min
```

---

**Versiรณn**: 1.0.0  
**Sistema**: SAD - Sistema Integrado de Archivos Digitales  
**รltima actualizaciรณn**: Noviembre 2025
